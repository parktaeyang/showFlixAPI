<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.showflix.api.auth.mapper.UserMapper">

    <!-- schedule_users 테이블에서 userid로 조회 -->
    <select id="findByUserid"
            parameterType="string"
            resultType="com.showflix.api.auth.domain.User">
        SELECT
            userid,
            username,
            password,
            is_admin AS admin
        FROM schedule_users
        WHERE userid = #{userid}
    </select>

    <!-- 배우(비관리자) 목록 조회 - Schedule 도메인에서 스케줄 테이블 열 구성에 사용 -->
    <select id="findActors"
            resultType="com.showflix.api.auth.domain.User">
        SELECT
            userid,
            username,
            password,
            is_admin AS admin
        FROM schedule_users
        WHERE is_admin = false
        ORDER BY username ASC
    </select>

    <!-- 전체 사용자 목록 조회 (관리자 페이지 계정관리용) -->
    <select id="findAll"
            resultType="com.showflix.api.auth.domain.User">
        SELECT
            userid,
            username,
            password,
            is_admin AS admin
        FROM schedule_users
        ORDER BY username ASC
    </select>

    <!-- 신규 계정 추가 -->
    <insert id="save"
            parameterType="com.showflix.api.auth.domain.User">
        INSERT INTO schedule_users (userid, username, password, is_admin)
        VALUES (#{userid}, #{username}, #{password}, #{admin})
    </insert>

    <!-- 계정 정보 수정 (username, is_admin) -->
    <update id="update"
            parameterType="com.showflix.api.auth.domain.User">
        UPDATE schedule_users
        SET username = #{username},
            is_admin = #{admin}
        WHERE userid = #{userid}
    </update>

    <!-- 비밀번호 변경 -->
    <update id="updatePassword">
        UPDATE schedule_users
        SET password = #{password}
        WHERE userid = #{userid}
    </update>

    <!-- 계정 삭제 -->
    <delete id="delete">
        DELETE FROM schedule_users
        WHERE userid = #{userid}
    </delete>

</mapper>

